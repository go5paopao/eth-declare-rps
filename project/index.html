<!DOCTYPE html>
<html lang="ja">
  <head>
    <title>Ethereum じゃんけんゲーム</title>
    <meta http-equiv="content-type" charset="utf-8">   
    <link rel="stylesheet" type="text/css" href="style/main.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js" charset="UTF-8"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.ethers.io/scripts/ethers-v3.min.js" charset="utf-8">
    <script type="text/javascript" src="/app/jsSHA/src/sha256.js" charset="UTF-8"></script>
    <script type="text/javascript" src="/main.js" charset="UTF-8"></script>
</script>
  </head>

  <body>
    <header>
      <h1>Ethereum じゃんけん</h1>
    </header>
    <div class="content">
      <h2>What is it?</h2>
      <p>これはEthereumのブロックチェーン上で実現したじゃんけんゲームです。</p>
      <p>ブロックチェーンの特質を考慮したじゃんけんのため、通常のじゃんけんより手順が複雑です。</p>
      <!-- access Ethereum blockchain by host and guest player-->
      <h2>Game Play</h2>
      <h3>Host Player</h3>
      <h4>1.MakeGame</h4>
      <div class="chooseHandArea">
        <fieldset>
          <legend class="chooseHand">手を選んでください。</legend>
          <input type="radio" name="hostHand" id="hostHandRock" value="1" checked="checked">
          <label for="hostHandRock">グー</label>
          <input type="radio" name="hostHand" id="hostHandScissor" value="2">
          <label for="hostHandScissor">チョキ</label>
          <input type="radio" name="hostHand" id="hostHandPaper" value="3">
          <label for="hostHandPaper">パー</label>
        </fieldset>
      </div>
      <div class="inputRndStrArea">
        <fieldset>
          <legend class="inputRndStr">ランダムな文字列を入力してください。</legend>
          <input type="text" size=20 id="hostRndStr">
        </fieldset>
      </div> 
      <p>
        <input class="ethCallButton" type="button" value="MakeGame" onClick="makeGame()"/>
      </p>
      <h4>3.SubmitHand</h4>
      <p>
        <input type="button" class="ethCallButton" value="Submit&Battle" onClick="hostSubmit()"/>
      </p>
      
      <h3>Guest Player</h3>
      <h4>2.JoinGame</h4>
      <div class="chooseHandArea">
        <fieldset>
          <legend class="chooseHand">手を選んでください。</legend>
          <input type="radio" name="guestHand" id="guestHandRock" value="1" checked="checked">
          <label for="guestHandRock">グー</label>
          <input type="radio" name="guestHand" id="guestHandScissor" value="2">
          <label for="guestHandScissor">チョキ</label>
          <input type="radio" name="guestHand" id="guestHandPaper" value="3">
          <label for="guestHandPaper">パー</label>
        </fieldset>
      </div>
      <div class="inputRndStrArea">
        <fieldset>
          <legend class="inputRndStr">ランダムな文字列を入力してください。</legend>
          <input type="text" size=20 id="guestRndStr">
        </fieldset>
      </div> 
      <p>
        <input class="ethCallButton" type="button" value="JoinGame" onclick="joinGame()"/>
      </p>
      <h3>Battle Result</h3>
      <div class="showResult" id="showGameResult"></div>
      <p>      
        <input type="button" class="ethCallButton" value="ShowResult" onClick="showResult()"/>
      </p>
      <h3>Reset</h3>
      <p>      
        <input type="button" class="ethCallButton"  value="RESET" onClick="reset()"/>
      </p>

      <!-- Show Status about this game and blockchain -->
      <h2>Status</h2>
      <h3>Player Address</h3>
      <table>
        <tbody>
          <tr>
            <th>HostPlayer</th>
            <td id="hostPlayerAddress"> </td>
          </tr>
          <tr>
            <th>GuestPlayer</th>
            <td id="guestPlayerAddress"> </td>
          </tr>
        </tbody>
      </table>
      <h3>Submit Hash</h3>
      <table>
        <tbody>
          <tr>
            <th>Host Local</th>
            <td id="hostLocalHash"></td>
          </tr>
          <tr>
            <th>Host Eth</th>
            <td id="hostEthHash"></td>
          </tr>
          <tr>
            <th>Guest Local</th>
            <td id="guestLocalHash"></td>
          </tr>
          <tr>
            <th>Guest Eth</th>
            <td id="guestEthHash"></td>
          </tr>
        </tbody>
      </table>
      <h3>Hash Check</h3>
      <h4>Host Player</h4>
      <div id="hostCheckResult" class="hashCheckMessage"></div>
      <p>
        <input type="button" class="ethCallButton" value="Check" onClick="hostGameCheck()"/>
      </p>
      <h4>Guest Player</h4>
      <div id="guestCheckResult" class="hashCheckMessage"></div>
      <p>
        <input type="button" class="ethCallButton" value="Check" onClick="guestGameCheck()"/>
      </p>
      <h2>Procedure</h2>
      <ol>
        <li>
          <h4>Hostがゲームを開く</h4>
          <ul>
            <li>
              HostPlayerがゲームを開きます。
            </li>
            <li>
              具体的には、ジャンケンの手とランダムな文字列を入力した上でMakeGameをします。
            </li>
            <li>
              MakeGameでは、手を提出すると同時にHostPlayerが資金(ether)をbetします(contractに預ける)。
            </li>
          </ul>
        </li>
        <li>
          <h4>Guestがゲームに参加</h4>
          <ul>
            <li>
              GuestPlayerがゲームに参加します。
            </li>
            <li>
              HostPlayerと同様にジャンケンの手とランダムな文字列を入力した上でJoinGameします。
            </li>
            <li>
              JoinGameでは、MakeGameと同じくGuestPlayerが資金(ether)をbetします(contractに預ける)。
            </li>
          </ul>
        </li> 
       <li>
         <h4>Hostが手を再提出</h4>
         <ul>
           <li>HostPlayerが改めて最初に決めた手（ジャンケンの手とランダムな文字列）を提出します。</li>
           <li>これはHostPlayerが何の手を出したのか、そして手を後出しで変えていないかを確認するためです。</li>
           <li>1の時点ではGuestPlayerに手がバレないように、ハッシュ値しかブロックチェーンに提出しておらず、ここで初めて手を提出します。</li>
         </ul>
       </li>
       <li>
         <h4>Gameの終了</h4>
         <ul>
           <li>3の終了時点で結果が出ています。</li>
           <li>ShowResultを押すことでどちらが勝ったのかを確認することができます。</li>
           <li>ちなみに3の終了時点で両者がbetしていた額の合計をcontractから勝者に送金します。<br>
           (実質、敗者から勝者に賭け金を送ったことになる。)</li>
           <li>RESETボタンを押すことで、再度ゲームすることができます。</li>
         </ul>
       </li>
     </ol>
    </div>
    <!-- footer -->
    <footer>
      <p>COPYRIGHT &#169; go5paopao ALL RIGHTS RESERVED. </p>
    </footer>
  </body>

</html>
